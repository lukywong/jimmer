<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-preface">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">前言 | Jimmer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://github.com/jimmer/zh/docs/preface"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="前言 | Jimmer"><meta data-rh="true" name="description" content="Jimmer提供了很多明显缺别于传统方案的能力。其中最重要的能力，就是开发人员不再面对零散的实体对象和实体关系，而是以任意复杂的数据结构为操作目标。"><meta data-rh="true" property="og:description" content="Jimmer提供了很多明显缺别于传统方案的能力。其中最重要的能力，就是开发人员不再面对零散的实体对象和实体关系，而是以任意复杂的数据结构为操作目标。"><link data-rh="true" rel="icon" href="/jimmer/zh/img/logo.png"><link data-rh="true" rel="canonical" href="https://github.com/jimmer/zh/docs/preface"><link data-rh="true" rel="alternate" href="https://github.com/jimmer/docs/preface" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/jimmer/zh/docs/preface" hreflang="zh"><link data-rh="true" rel="alternate" href="https://github.com/jimmer/docs/preface" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/jimmer/zh/blog/rss.xml" title="Jimmer RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/jimmer/zh/blog/atom.xml" title="Jimmer Atom Feed"><link rel="stylesheet" href="/jimmer/zh/assets/css/styles.1f291466.css">
<link rel="preload" href="/jimmer/zh/assets/js/runtime~main.1af06925.js" as="script">
<link rel="preload" href="/jimmer/zh/assets/js/main.9f4cb911.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/jimmer/zh/"><div class="navbar__logo"><img src="/jimmer/zh/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/jimmer/zh/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Jimmer documentation</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/jimmer/zh/docs/preface">View more</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/jimmer/docs/preface" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/jimmer/zh/docs/preface" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/babyfish-ct/jimmer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/jimmer/zh/docs/preface">前言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/jimmer/zh/docs/intro">教程介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/jimmer/zh/docs/get-started">快速上手</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/jimmer/zh/docs/benchmark">Benchmark</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/jimmer/zh/docs/jimmer-core/">jimmer-core子项目</a><button aria-label="打开/收起侧边栏菜单「jimmer-core子项目」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/jimmer/zh/docs/jimmer-sql/">jimmer-sql子项目</a><button aria-label="打开/收起侧边栏菜单「jimmer-sql子项目」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/jimmer/zh/docs/spring-graphql">对Spring GraphQL的支持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/jimmer/zh/docs/demo">附带demo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/jimmer/zh/docs/agreement">和开发人员的约定</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/jimmer/zh/docs/discuss">讨论</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/jimmer/zh/docs/ecosystem">生态</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/jimmer/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">前言</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>前言</h1></header><p>Jimmer提供了很多明显缺别于传统方案的能力。其中最重要的能力，就是开发人员不再面对零散的实体对象和实体关系，而是以任意复杂的数据结构为操作目标。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="表达任意复杂的数据结构">表达任意复杂的数据结构<a class="hash-link" href="#表达任意复杂的数据结构" title="标题的直接链接">​</a></h2><p><img loading="lazy" alt="shape" src="/jimmer/zh/assets/images/shape-877c9a8df8953a5c8b7e0af6f45b8bea.png" width="1150" height="856" class="img_ev3q"></p><p>这幅图示范了一个全局的关系型数据库模型和三个业务视角。</p><p>每个业务视角观察全局关系型数据库模型中的某个区域。</p><ul><li><p>该区域的形状千变万化，你可以自由决定它是否包含某些实体、关联甚至属性。</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>这里所说的属性，不仅包括图中展示的数据库映射属性，还包括和数据库结构无关的业务性属性。</p></div></div></li><li><p>该区域的形状无需事先设计，可以灵活变动，随着需求的变化而变化。</p></li></ul><p>当然，作为面向Java和Kotlin的解决方案，Jimmer的实体类型必然是强类型的，但，同时也是动态的。</p><p>所谓动态实体，指实体对象的任何属性，无论是普通属性、关联属性还是和数据模型无关的业务性属性，都可以不指定。这样，动态实体可以描述任意复杂的数据结构。</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>不指定对象的某个属性，和把对象的某个属性设置为null，在Jimmer中是完全不同的两回事。</p></div></div><p>另外，Jimmer保证动态实体所描述的数据结构不包含环形引用，是一个由聚合根和单向关系构成的树，所以，可以直接通过HTTP协议传递。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>动态实体既可以表达任意复杂的数据结构，又能直接参与HTTP传输。所以，开发人员应该<strong>使用统一的实体模型来表达任何业务所需的数据格式，而非为每一个业务场景所需的数据格式定义DTO</strong>，避免冗余的数据定义让系统丧失紧凑型。</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="查询任意复杂的数据结构">查询任意复杂的数据结构<a class="hash-link" href="#查询任意复杂的数据结构" title="标题的直接链接">​</a></h2><p>Jimmer提供了两种方法，用于查询任意复杂的数据结构</p><ul><li><p>在服务端指定被查询数据结构的形状</p></li><li><p>在客户端端指定被查询数据结构的形状</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-在服务端指定被查询数据结构的形状">1. 在服务端指定被查询数据结构的形状<a class="hash-link" href="#1-在服务端指定被查询数据结构的形状" title="标题的直接链接">​</a></h3><p>Jimmer支持一个叫<a href="/jimmer/zh/docs/jimmer-sql/query/fetcher">对象抓取器</a>的功能，该功能赋予开发人员从数据库中查询任意复杂的数据结构的能力。</p><p>请观看如下视频。</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Java</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Kotlin</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><video width="100%" controls=""><source src="/jimmer/zh/assets/medias/java-fetcher-a47c6f710d4cc259e540c4a5909ae021.mp4" type="video/mp4"><div style="padding:1rem;font-size:2rem;color:red">Your browser does not support the video tag.</div></video></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><video width="100%" controls=""><source src="/jimmer/zh/assets/medias/kotlin-fetcher-b8ddc7a4ad25644d36d580ac726ec13f.mp4" type="video/mp4"><div style="padding:1rem;font-size:2rem;color:red">Your browser does not support the video tag.</div></video></div></div></div><p><a href="/jimmer/zh/docs/jimmer-sql/query/fetcher">对象抓取器</a>还具备一个视频中没有展示的强大能力，对于自关联属性进行递归抓取，有兴趣可以查阅<a href="/jimmer/zh/docs/jimmer-sql/query/fetcher#%E8%87%AA%E5%85%B3%E8%81%94%E9%80%92%E5%BD%92%E6%8A%93%E5%8F%96">自关联递归抓取</a>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-在客户端端指定被查询数据结构的形状">2. 在客户端端指定被查询数据结构的形状<a class="hash-link" href="#2-在客户端端指定被查询数据结构的形状" title="标题的直接链接">​</a></h3><p><a href="https://graphql.org/" target="_blank" rel="noopener noreferrer">GraphQL</a>是一个用于在客户端查询任意复杂数据的协议，但其缺点是服务端开发成本稍微高。</p><p>SpringBoot从2.7.0开始支持<a href="https://spring.io/projects/spring-graphql" target="_blank" rel="noopener noreferrer">Spring GraphQL</a>，Jimmer为此提供了针对性支持，可以让基于<code>Spring GraphQL</code>的开发工作成本变得很低。</p><video width="100%" controls=""><source src="/jimmer/zh/assets/medias/graphql-fetcher-34e0bb75712c966bd614fa03d964de4f.mp4" type="video/mp4"><div style="padding:1rem;font-size:2rem;color:red">Your browser does not support the video tag.</div></video><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>注意，受限于目前的GraphQL协议，这种方法并没有<a href="/jimmer/zh/docs/jimmer-sql/query/fetcher">对象抓取器</a>那种对自关联属性的递归查询能力。</p><p>如果你的业务场景既需要对自关联属性的递归查询能力，又需要把被查数据结构的形状的决定权暴露给客户端，你可以自定义一个类似于GraphQL的文本协议，客户端按照自定义协议提交特定格式的文本，服务端将其转换为<a href="/jimmer/zh/docs/jimmer-sql/query/fetcher">对象抓取器</a>再查询，这非常容易。</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="保存任意复杂的数据结构">保存任意复杂的数据结构<a class="hash-link" href="#保存任意复杂的数据结构" title="标题的直接链接">​</a></h2><p>开发人员可以利用Jimmer实体的动态性构建任意复杂的数据结构，交由Jimmer保存。</p><p>Jimmer会把数据库中现有数据结构和用户期望保存的数据结构做diff，然后修改不一致的部分，最终让数据库中的数据结构和用户期望的数据结构一致。</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>Jimmer的保存功能有点类似web领域的react和vue.</p></div></div><p>如图</p><p><img loading="lazy" alt="save" src="/jimmer/zh/assets/images/save-6631bb52e10864ffe98320a913473282.png" width="1473" height="1036" class="img_ev3q"></p><p>图片左上为数据库中现有数据结构；右上为用户期望的数据结构，其中每个对象，要么指定id，要么指定业务key和id增长策略。</p><p>图片下方为Jimmer执行的操作，用了四种颜色进行标注。</p><ul><li><p>红色部分：当某个对象在数据库现有数据结构中存在，而在用户期望保存的数据结构中不存在时，可能会导致这个此对象及其关联被删除。用户可以干预此环节，选择阻止操作、仅断开关系或删除对象。</p></li><li><p>绿色部分：当某个对象在数据库现有数据结构中不存在，而在用户期望保存的数据结构中存在时，可能会导致这个此对象及其关联被新建。用户可以干预此环节，选择阻止操作、或允许操作。</p></li><li><p>蓝色部分：当某个对象在数据库现有数据结构中和其他对象的关联，和用户期望保存的数据结构中对应对象和其他对象的关联不同时，自动调整关联。</p></li><li><p>黄色部分：当某个对象在数据库现有数据结构中存在，且在用户期望保存的数据结构中对应的对象具备待修改的属性时，修改对象属性。由于Jimmer实体是动态的，允许对象缺失任何属性，只修改部分属性而非全部是被允许的。</p></li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>和其他持久化方案不同，Jimmer无需事先决定每个关系是否级联保存，是否级联保存完全依赖用户指定的数据结构的形状。</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="缓存任意复杂的数据结构含一致性维护">缓存任意复杂的数据结构（含一致性维护）<a class="hash-link" href="#缓存任意复杂的数据结构含一致性维护" title="标题的直接链接">​</a></h2><p>前面谈到，Jimmer可以查询任意复杂的数据结构。为了让应用具备性能优势，相应地，Jimmer支持针对任意复杂的数据结构的缓存。</p><p>从实现层面讲，Jimmer的缓存有两种，对象缓存和属性缓存。其中，属性缓存又可以进一步分为关联属性缓存和计算属性缓存。</p><p>对象缓存和关联缓存在幕后的结合使用，最终，从用户看，就是针对任意复杂的数据结构的缓存。</p><p>Jimmer的缓存机制有如下特色</p><ul><li><p>对用户采用何种缓存技术不做任何限制。</p></li><li><p>对使用者透明，是否使用缓存不会导致业务代码变化。</p></li><li><p>支持多级缓存，比如第一级采用JVM内部的caffine，第二级别采用集群共享的redis。</p></li><li><p>不是强制的，整个框架可以以无缓存模式工作。即使启用了缓存能力，用户仍然可以精细地控制每个实体类型是否采用对象缓存，以及每个关联属性或计算属性是否采用属性缓存。</p></li><li><p>良好的数据一致性支持。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-简单对象缓存">1. 简单对象缓存<a class="hash-link" href="#1-简单对象缓存" title="标题的直接链接">​</a></h3><p>简单对象缓存，负责把对象id映射成简单对象。除了外键外，简单对象不具备任何关联属性。</p><p><img loading="lazy" alt="object-cache" src="/jimmer/zh/assets/images/object-cache-1e3e25443866288f4e42a9ca766df4e6.jpeg" width="1194" height="1028" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-关联属性缓存">2. 关联属性缓存<a class="hash-link" href="#2-关联属性缓存" title="标题的直接链接">​</a></h3><p>关联属性缓存，为数据提供邻接表。以支持快速查询任意复杂数据结构</p><p><img loading="lazy" alt="association-cache" src="/jimmer/zh/assets/images/association-cache-86841d247e9ed2ecb62f0387b646706f.jpeg" width="1368" height="1262" class="img_ev3q"></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>对于基于外键而非中间表多对一关联(图中的<code>Book.store-1</code>、<code>Book.store-2</code>和<code>Book.store-3</code>)而言，仅在GraphQL工作模式中开发人员给予的上级对象的外键属性缺失时才使用；其余情况下，以外键为参数查询简单对象缓存得到父对象。</p></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><ol><li>关系性数据库的缺点之一，在于数据关联需要查询。关联缓存提供访问方式更直接的邻接表数据，很好地缓解了这个问题。</li></ol></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-计算属性缓存">3. 计算属性缓存<a class="hash-link" href="#3-计算属性缓存" title="标题的直接链接">​</a></h3><p>Jimmer实体支持非持久化(<code>@Transient</code>)属性，这种属性在数据库中没有对应的字段，用于表达面开发人员自定义的业务属性，和数据库结构无关。</p><p>非持久化属性有两种</p><ul><li><p>手动模式：Jimmer不会对这类属性做任何操作，实体对象是否具备此属性，完全取决于用户的业务代码是否填充它</p></li><li><p>自动模式：如果<a href="/jimmer/zh/docs/jimmer-sql/query/fetcher">对象抓取器</a>或GraphQL要查询这类属性，Jimmer会调用当前属性注解中配置的计算解决器，完成计算并自动设置该属性。</p></li></ul><p>其中，自动模式的非持久化属性也称计算属性，计算属性可以选择采用计算缓存。</p><p><img loading="lazy" alt="calculated-cache" src="/jimmer/zh/assets/images/calculated-cache-1d6c340f3591ba25fb4a123152874692.jpeg" width="1122" height="826" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-多视角缓存">4. 多视角缓存<a class="hash-link" href="#4-多视角缓存" title="标题的直接链接">​</a></h3><p>Jimmer提供了<a href="/jimmer/zh/docs/jimmer-sql/query/filter">全局过滤器</a>，可以在所有查询中对某些实体类进行隐式的条件过滤。</p><p>该功能可以很方便地实现基于行的数据授权，自然会导致不同的操作者看到的数据不一样。</p><p>既然不同的操作者看到的数据不一样，自然也需要让不同的操作者看到的缓存不一样，这就是多视角缓存。</p><p><img loading="lazy" alt="multi-view-cache" src="/jimmer/zh/assets/images/multi-view-cache-26468ea2ed8d67e9f79f7884b263b5ef.jpeg" width="1256" height="1710" class="img_ev3q"></p><p>这个例子以多租户为例子展现了多视角缓存。不同的操作者看到的关联缓存和计算缓存不一样。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>多视角缓存会导致更快的缓存空间消耗，应仅针对重要的关联属性或计算属性使用。开发人员可以自由决定某个关联属性或计算属性仅使用普通缓存还是要使用多视角缓存。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-缓存一致性">5. 缓存一致性<a class="hash-link" href="#5-缓存一致性" title="标题的直接链接">​</a></h3><p>Jimmer实现了相对实时的缓存数据一致性。为此，开发人员只需要：</p><ul><li>采用支持binlog的数据库，并启用binlog</li><li>使用任何第三方技术(Maxwell、Canal或DataBus)，接收binlog事件。</li><li>调用Jimmer的全局API<code>invalidateByBinLog</code>。</li></ul><p>然后</p><ul><li>如果应用仅仅使用了对象缓存和关联缓存，用户不需要做任何事，全自动。</li><li>如果应用使用了计算缓存或多视角缓存，需要用户的辅助，但是非常简单。</li></ul><p>示例</p><ol><li><p>修改外键，自动清除关联缓存和计算缓存。</p><p><img loading="lazy" alt="modify_fk" src="/jimmer/zh/assets/images/modify_fk-ec09667d0549c54863e5a61f37940e9a.gif" width="600" height="438" class="img_ev3q"></p></li><li><p>修改中间表，自动清除关联缓存。</p><p><img loading="lazy" alt="insert_middle_table" src="/jimmer/zh/assets/images/insert_middle_table-736e675fe9d012a6a269d555ea59d7c0.gif" width="600" height="438" class="img_ev3q"></p></li><li><p>修改计算属性依赖的字段，自动清除计算缓存。</p><p><img loading="lazy" alt="modify_price" src="/jimmer/zh/assets/images/modify_price-ced79acc8e041f77cd71b64913403956.gif" width="600" height="438" class="img_ev3q"></p></li><li><p>修改过滤器依赖的字段，自动清除关联缓存和计算缓存。</p><p><img loading="lazy" alt="modify_tenant" src="/jimmer/zh/assets/images/modify_tenant-1520daf16c79bb704d2f81c4b026237a.gif" width="600" height="438" class="img_ev3q"></p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其它功能">其它功能<a class="hash-link" href="#其它功能" title="标题的直接链接">​</a></h2><ul><li><p>强类型的DSL，尽可能在编译发现错误；强类型DSL可以和Native SQL混合使用。</p></li><li><p>基于属性路径的、超简单的多表连接操作，自动合并不同路径中的冲突连接，并自动优化去掉不必要的表连接。</p></li><li><p>基于数据对象查询，自动生成并优化分页业务所需的行数查询。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="未来可能会加入的功能">未来可能会加入的功能<a class="hash-link" href="#未来可能会加入的功能" title="标题的直接链接">​</a></h2><ul><li><p>不限制用户的微服务治理框架，让实体对象支持跨越微服务边界的远程关联。</p></li><li><p>虽然可以利用SQL分组和聚合来实现计算属性，但分组和聚合统计类业务并不是关系性OLTP数据库的专长，未来可能支持把计算属性映射到Clickhouse这类基于列的OLAP数据库。</p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/babyfish-ct/jimmer/tree/main/doc/docs/preface.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--next" href="/jimmer/zh/docs/intro"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">教程介绍</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#表达任意复杂的数据结构" class="table-of-contents__link toc-highlight">表达任意复杂的数据结构</a></li><li><a href="#查询任意复杂的数据结构" class="table-of-contents__link toc-highlight">查询任意复杂的数据结构</a><ul><li><a href="#1-在服务端指定被查询数据结构的形状" class="table-of-contents__link toc-highlight">1. 在服务端指定被查询数据结构的形状</a></li><li><a href="#2-在客户端端指定被查询数据结构的形状" class="table-of-contents__link toc-highlight">2. 在客户端端指定被查询数据结构的形状</a></li></ul></li><li><a href="#保存任意复杂的数据结构" class="table-of-contents__link toc-highlight">保存任意复杂的数据结构</a></li><li><a href="#缓存任意复杂的数据结构含一致性维护" class="table-of-contents__link toc-highlight">缓存任意复杂的数据结构（含一致性维护）</a><ul><li><a href="#1-简单对象缓存" class="table-of-contents__link toc-highlight">1. 简单对象缓存</a></li><li><a href="#2-关联属性缓存" class="table-of-contents__link toc-highlight">2. 关联属性缓存</a></li><li><a href="#3-计算属性缓存" class="table-of-contents__link toc-highlight">3. 计算属性缓存</a></li><li><a href="#4-多视角缓存" class="table-of-contents__link toc-highlight">4. 多视角缓存</a></li><li><a href="#5-缓存一致性" class="table-of-contents__link toc-highlight">5. 缓存一致性</a></li></ul></li><li><a href="#其它功能" class="table-of-contents__link toc-highlight">其它功能</a></li><li><a href="#未来可能会加入的功能" class="table-of-contents__link toc-highlight">未来可能会加入的功能</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/jimmer/zh/docs/intro">Tutorial</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 jimmer, Inc.</div></div></div></footer></div>
<script src="/jimmer/zh/assets/js/runtime~main.1af06925.js"></script>
<script src="/jimmer/zh/assets/js/main.9f4cb911.js"></script>
</body>
</html>